"use strict";var J=require("worker_threads"),l=require("../node-features-CKvB621_.cjs"),N=require("module"),T=require("../source-map.cjs"),h=require("path"),g=require("url"),v=require("../index-D78kOPjy.cjs"),R=require("../is-relative-path-pattern-D6NaPCaG.cjs"),E=require("../client-SVUnbl6F.cjs"),d=require("get-tsconfig"),q=require("fs");require("esbuild"),require("crypto"),require("os"),require("../temporary-directory-CoGR4SrV.cjs"),require("net"),require("../get-pipe-path-d1K0T1_d.cjs");var m=typeof document<"u"?document.currentScript:null;const b=()=>{T.installSourceMapSupport(),N.register("./index.mjs",{parentURL:typeof document>"u"?require("url").pathToFileURL(__filename).href:m&&m.src||new URL("esm/index.cjs",document.baseURI).href,data:!0})},f=new Map,D=async e=>{if(f.has(e))return f.get(e);if(!await q.promises.access(e).then(()=>!0,()=>!1)){f.set(e,void 0);return}const r=await q.promises.readFile(e,"utf8");try{const a=JSON.parse(r);return f.set(e,a),a}catch{throw new Error(`Error parsing: ${e}`)}},x=async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const r=g.fileURLToPath(t),a=await D(r);if(a)return a;const o=t;if(t=new URL("../package.json",t),t.pathname===o.pathname)break}},A=async e=>{var t;const r=await x(e);return(t=r==null?void 0:r.type)!=null?t:"commonjs"};var S,k;const u=process.env.TSX_TSCONFIG_PATH?{path:h.resolve(process.env.TSX_TSCONFIG_PATH),config:d.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:d.getTsconfig(),I=u&&d.createFilesMatcher(u),U=u&&d.createPathsMatcher(u),C=(k=(S=u==null?void 0:u.config.compilerOptions)==null?void 0:S.allowJs)!=null?k:!1,j="file://",w=/\.([cm]?ts|[tj]sx)($|\?)/,W=/\.json(?:$|\?)/,G=e=>{const t=h.extname(e);if(t===".json")return"json";if(t===".mjs"||t===".mts")return"module";if(t===".cjs"||t===".cts")return"commonjs"},H=e=>{const t=G(e);if(t)return t;if(w.test(e))return A(e)},F=T.installSourceMapSupport(),O=/\/(?:$|\?)/,X=async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`)},$=()=>`
const require = getBuiltin('module').createRequire("${typeof document>"u"?require("url").pathToFileURL(__filename).href:m&&m.src||new URL("esm/index.cjs",document.baseURI).href}");
require('../source-map.cjs').installSourceMapSupport();
`,y=async(e,t,r)=>{const a=await e(t,r);return!a.format&&a.url.startsWith(j)&&(a.format=await H(a.url)),a},z=[".js",".json",".ts",".tsx",".jsx"],_=async(e,t,r)=>{const[a,o]=e.split("?");let c;for(const n of z)try{return await y(r,a+n+(o?`?${o}`:""),t)}catch(s){if(c===void 0&&s instanceof Error){const{message:i}=s;s.message=s.message.replace(`${n}'`,"'"),s.stack=s.stack.replace(i,s.message),c=s}}throw c},M=async(e,t,r)=>{const a=O.test(e),o=a?"index":"/index",[c,n]=e.split("?");try{return await _(c+o+(n?`?${n}`:""),t,r)}catch(s){if(!a)try{return await _(e,t,r)}catch{}const i=s,{message:p}=i;throw i.message=i.message.replace(`${o.replace("/",h.sep)}'`,"'"),i.stack=i.stack.replace(p,i.message),i}},L=async(e,t,r,a)=>{var o;if(O.test(e))return await M(e,t,r);const c=e.startsWith(j)||R.isRelativePathPattern.test(e);if(U&&!c&&!((o=t.parentURL)!=null&&o.includes("/node_modules/"))){const n=U(e);for(const s of n)try{return await L(g.pathToFileURL(s).toString(),t,r)}catch{}}if(w.test(t.parentURL)||C){const n=R.resolveTsPath(e);if(n)for(const s of n)try{return await y(r,s,t)}catch(i){const{code:p}=i;if(p!=="ERR_MODULE_NOT_FOUND"&&p!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}}try{return await y(r,e,t)}catch(n){if(n instanceof Error&&!a){const{code:s}=n;if(s==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await M(e,t,r)}catch(i){if(i.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw i}if(s==="ERR_MODULE_NOT_FOUND")try{return await _(e,t,r)}catch{}}throw n}},P=l.isFeatureSupported(l.importAttributes)?"importAttributes":"importAssertions",K=async(e,t,r)=>{var a;E.parent.send&&E.parent.send({type:"dependency",path:e}),W.test(e)&&(t[P]||(t[P]={}),t[P].type="json");const o=await r(e,t);if(!o.source)return o;const c=e.startsWith("file://")?g.fileURLToPath(e):e,n=o.source.toString();if(o.format==="json"||w.test(e)){const s=await v.transform(n,c,{tsconfigRaw:(a=I)==null?void 0:a(c)});return{format:"module",source:F(s)}}if(o.format==="module"){const s=v.transformDynamicImport(c,n);s&&(o.source=F(s))}return o};l.isFeatureSupported(l.moduleRegister)&&J.isMainThread&&b(),exports.globalPreload=$,exports.initialize=X,exports.load=K,exports.resolve=L;
