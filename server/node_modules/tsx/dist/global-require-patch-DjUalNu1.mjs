import c from"module";import E from"fs";import{parseTsconfig as O,getTsconfig as j,createFilesMatcher as M,createPathsMatcher as b}from"get-tsconfig";import{p as g,t as P,a as A}from"./index-NttFZkao.mjs";import{shouldApplySourceMap as _,inlineSourceMap as v}from"./source-map.mjs";import{p as T}from"./client-SVJjVqAT.mjs";import p from"path";import{i as N,r as R}from"./is-relative-path-pattern-B4sgw8uQ.mjs";const I=e=>{if(e.includes("import")||e.includes("export"))try{return g(e)[3]}catch{return!0}return!1},C=/\.[cm]?tsx?$/,m=process.env.TSX_TSCONFIG_PATH?{path:p.resolve(process.env.TSX_TSCONFIG_PATH),config:O(process.env.TSX_TSCONFIG_PATH)}:j(),D=[".cts",".mts",".ts",".tsx",".jsx"],G=[".js",".cjs",".mjs"],h=m&&M(m),f=Object.assign(Object.create(null),c._extensions),H=f[".js"],x=(e,s)=>{var n;(n=T)!=null&&n.send&&T.send({type:"dependency",path:s});const r=D.some(o=>s.endsWith(o)),a=G.some(o=>s.endsWith(o));if(!r&&!a)return H(e,s);let t=E.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const o=P(s,t);o&&(t=_()?v(o):o.code)}else if(r||I(t)){const o=A(t,s,{tsconfigRaw:h==null?void 0:h(s)});t=_()?v(o):o.code}e._compile(t,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=x}),Object.defineProperty(f,".mjs",{value:x,enumerable:!1});const X=`${p.sep}node_modules${p.sep}`,y=m&&b(m),u=c._resolveFilename.bind(c),F=(e,s,n,r)=>{var a,t;const o=R(e);if(s!=null&&s.filename&&(C.test(s.filename)||(t=(a=m)==null?void 0:a.config.compilerOptions)!=null&&t.allowJs)&&o)for(const d of o)try{return u(d,s,n,r)}catch(i){const{code:l}=i;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},S=(e,s,n,r)=>{var a;const t=e.indexOf("?");if(t!==-1&&(e=e.slice(0,t)),y&&!N.test(e)&&!((a=s==null?void 0:s.filename)!=null&&a.includes(X))){const d=y(e);for(const i of d){const l=F(i,s,n,r);if(l)return l;try{return u(i,s,n,r)}catch{}}}const o=F(e,s,n,r);return o||u(e,s,n,r)},w=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=f,c._resolveFilename=S,()=>{e===!1&&process.setSourceMapsEnabled(!1),c._extensions=s,c._resolveFilename=n}};export{S as a,w as r};
